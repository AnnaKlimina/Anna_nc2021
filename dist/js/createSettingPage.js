async function createSettingPage(){let e=document.querySelector(".main-page");e.dataset.currentPage="user-settings-page",e.innerHTML="",e.append(tmplSettingForm.content.cloneNode(!0));let t=e.querySelector(".form-block[data-appeared-block=settings]");document.getElementById("changeAvatarForm").elements.login.value=document.querySelector(".authorization-block__user-login").textContent,t.login.onblur=checkLogin,t.oldPassword.onblur=async function(e){let t,o=await fetch("https://my-library-project-server.herokuapp.com/check_password?login="+document.querySelector(".authorization-block__user-login").textContent+"&input="+e.target.value);o.ok?t=await o.json():(alert(o.status),t=!1),t?removeWarning(e.target):createWarning(e.target,"Неправильный пароль")},t.password.onblur=checkPassword,t.repeatPassword.onblur=checkRepeatPassword("settings"),t.addEventListener("click",(async function(e){if("BUTTON"!==e.target.tagName)return;let t,o=e.target.closest("fieldset");switch(e.target.name){case"changeAvatar":if(!e.target.closest(".form-block").avatar.files)return;document.querySelector(".authorization-block__icon").style.backgroundImage="url("+window.URL.createObjectURL(e.target.closest(".form-block").avatar.files[0])+")";break;case"changeLogin":if(e.preventDefault(),!checkLoginOnSubmit(o))return;let a={old:document.querySelector(".authorization-block__user-login").textContent,new:e.target.closest(".form-block").login.value};t=await fetch("https://my-library-project-server.herokuapp.com/change_login",{method:"POST",mode:"cors",dataType:"json",headers:{Accept:"application/json"},body:JSON.stringify(a)}),document.querySelector(".authorization-block__user-login").textContent=e.target.closest(".form-block").login.value,e.target.closest(".form-block").login.value="";break;case"changePassword":let r;if(e.preventDefault(),t=await fetch("https://my-library-project-server.herokuapp.com/check_password?login="+document.querySelector(".authorization-block__user-login").textContent+"&input="+e.target.value),t.ok?r=await t.json():(alert(t.status),r=!1),!(checkPasswordOnSubmit(o)&&checkRepeatPasswordOnSubmit(o)&&r))return;let n={login:document.querySelector(".authorization-block__user-login").textContent,newPassword:e.target.closest(".form-block").password.value};t=await fetch("https://my-library-project-server.herokuapp.com/change_password",{method:"POST",mode:"cors",dataType:"json",headers:{Accept:"application/json"},body:JSON.stringify(n)}),e.target.closest(".form-block").oldPassword.value="",e.target.closest(".form-block").password.value="",e.target.closest(".form-block").repeatPassword.value=""}}))}