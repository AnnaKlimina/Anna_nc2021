function sortBooks(e,t){for(let o=e.length-1;o>0;o--)for(let c=0;c<o;c++){e[c][t]-e[c+1][t]<0&&e[c+1].after(e[c])}}function fillBooksPage(e){if(document.querySelector(".articles-grid").innerHTML="",document.querySelector(".main-page__announcement")?.remove(),!e.length){let e=document.createElement("div");return e.textContent="Книг не найдено",e.className="main-page__announcement",void document.querySelector(".main-page").append(e)}for(let t=0;t<e.length;t++){let o=tmplBookCard.content.cloneNode(!0);document.querySelector(".articles-grid").append(o),o=document.querySelector(".article:last-of-type"),o.setAttribute("data-book",e[t].bookName+","+e[t].bookAuthor),o["data-addDate"]=new Date(e[t].addDate),o["data-addCount"]=e[t].addCount,o.querySelectorAll(".reactions-block__count")[0].textContent=e[t].commentCount,o.querySelectorAll(".reactions-block__count")[1].textContent=e[t].addCount,o.querySelector(".article__book-picture").style.backgroundImage="url("+e[t].img+")",o.querySelector(".book-header__name").textContent=e[t].bookName,o.querySelector(".book-header__author").textContent=e[t].bookAuthor,o.querySelector(".content__main").textContent=e[t].bookContent;let c=o.querySelector(".article-footer__book-genres");for(let o of e[t].genreList){let e=document.createElement("li");e.className="book-genre-list__item",e.textContent=o,c.append(e)}}}function createBooksPage(e,t,o=!1){let c=document.querySelector(".main-page");if(c.dataset.currentPage=t,c.innerHTML=o?'<div class="cite-block">\n            <div class="cite-block__picture-wrapper">\n                <div class="cite-block__picture"></div>\n            </div>\n            <div class="cite-block__cite-container">\n                <cite class="cite-block__cite"></cite>\n                <div class="cite-block__resource"></div>\n            </div>\n        </div>\n        <div class="search-block">\n          <div class="search-container">\n            <div class="form-block__logo logo">\n              <span class="logo__text">YourLib</span>\n              <svg class="logo__icon" height="25px" width="25px" viewBox="0 0 128 128"><use xlink:href="#book" /></svg>\n            </div>\n            <div class="search-container__wrapper">\n              <input class="search-container__input" value="введите автора или название книги">\n              <button class="search-container__button button">Поиск</button>\n            </div>\n          </div>\n          <div class="search-container__checkbox-container checkbox-container">\n            <div class="checkbox-container__header">Жанры</div>\n            <div class="checkbox-container__wrapper"></div>\n            <button  class="checkbox-container__button button">Применить фильтр</button>\n          </div>\n          <button class="search-block__button button">Показать все книги</button>\n          <div class="sort-buttons book-content">\n            <div class="book-content__header">Сортировать по</div>\n            <button class="book-content__button button" data-button-task="sortByAdds">популярности</button>\n            <button class="book-content__button button" data-button-task="sortByDate">новизне</button></div>\n        </div>':"",c.innerHTML+='<div class="articles-grid"></div>',o){document.querySelector(".cite-block__picture").style.backgroundImage="url("+citeBlock.image+")",document.querySelector(".cite-block__cite").textContent=citeBlock.cite,document.querySelector(".cite-block__resource").textContent=citeBlock.resource,document.querySelector(".search-container__button").addEventListener("click",(async function(e){let t=document.querySelector(".search-container__input").value;if(""===t)return;let o,c=await fetch("https://my-library-project-server.herokuapp.com/search?book="+t);c.ok?(o=await c.json(),fillBooksPage(o)):alert(c.status)}));for(let e of genreList){let t=document.createElement("div");t.className="checkbox-container__checkbox-wrapper",document.querySelector(".checkbox-container__wrapper").append(t);let o=document.createElement("input");o.type="checkbox",o.name=e,o.className="checkbox-container__checkbox",document.querySelector(".checkbox-container__checkbox-wrapper:last-of-type").append(o);let c=document.createElement("label");c.for=e,c.className="checkbox-container__label",c.innerHTML=e,document.querySelector(".checkbox-container__checkbox-wrapper:last-of-type").append(c)}document.querySelector(".checkbox-container__button").addEventListener("click",(async function(e){let t=Array.from(document.querySelectorAll(".checkbox-container__checkbox")).reduce(((e,t)=>(t.checked&&e.push(t.name),e)),[]);if(!t.length)return;let o,c=await fetch("https://my-library-project-server.herokuapp.com/filter?genres="+JSON.stringify(t));c.ok?(o=await c.json(),fillBooksPage(o)):alert(c.status)})),document.querySelector(".search-block__button").addEventListener("click",(async function(e){document.querySelector(".search-container__input").value="введите автора или название книги",Array.from(document.querySelectorAll(".checkbox-container__checkbox")).forEach((e=>e.checked=!1));let t,o=await fetch("https://my-library-project-server.herokuapp.com/library");o.ok?(t=await o.json(),fillBooksPage(t)):alert(o.status)})),document.querySelector(".sort-buttons").addEventListener("click",(function(e){switch(e.target.dataset?.buttonTask){case"sortByAdds":sortBooks(document.getElementsByClassName("article"),"data-addCount");break;case"sortByDate":sortBooks(document.getElementsByClassName("article"),"data-addDate")}}))}fillBooksPage(e)}